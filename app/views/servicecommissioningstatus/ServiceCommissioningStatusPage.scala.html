@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.cataloguefrontend.servicecommissioningstatus.ServiceCommissioningStatus
@import uk.gov.hmrc.cataloguefrontend.servicecommissioningstatus.StatusCheck
@import uk.gov.hmrc.cataloguefrontend.model.Environment
@import uk.gov.hmrc.cataloguefrontend.model.Environment.Integration

@this()

@(serviceCommissioningStatus: ServiceCommissioningStatus
)(implicit
  messages: Messages,
  request: Request[_]
)
    @standard_layout("Service-Commissioning-Status") {
        <header>
            <h1>Service Commissioning Status: @serviceCommissioningStatus.serviceName</h1>
        </header>

        <div class="row">
            <div class="col-sm-6">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Status Check</th>
                            <th colspan="6">Service Commissioning Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>@simpleStatusCheck("Github Repo", serviceCommissioningStatus.hasRepo.evidence)</tr>

                        <tr>@simpleStatusCheck("App Config Base", serviceCommissioningStatus.hasAppConfigBase.evidence)</tr>

                        <tr>@environmentStatusCheck("App Config Environment", serviceCommissioningStatus.hasAppConfigEnv.asMap)</tr>

                        <tr>@environmentStatusCheck("Frontend Routes", serviceCommissioningStatus.hasFrontendRoutes.asMap)</tr>

                        <tr>@simpleStatusCheck("Build Jobs", serviceCommissioningStatus.hasBuildJobs.evidence)</tr>

                        <tr>@simpleStatusCheck("Service Manager Config", serviceCommissioningStatus.hasSMConfig.evidence)</tr>

                        <tr>@environmentStatusCheck("Deployed", serviceCommissioningStatus.isDeployed.asMap)</tr>

                        <tr>@simpleStatusCheck("Kibana", serviceCommissioningStatus.hasDashboards.grafana.evidence)</tr>

                        <tr>@simpleStatusCheck("Grafana", serviceCommissioningStatus.hasDashboards.grafana.evidence)</tr>

                        <tr>@simpleStatusCheck("Alerts", serviceCommissioningStatus.hasAlerts.evidence)</tr>
                    </tbody>
                </table>
            </div>
        </div>
    }

@simpleStatusCheck(statusCheck: String, evidence: Option[String]) = {
    <td>@statusCheck</td>

    <td style="text-align: center">
        @evidence match {
            case Some(evidence) => {
                <span class="glyphicon glyphicon-ok low"></span>
                <a href="@evidence" target="_blank" rel="noopener noreferrer">[view]</a>
            }
            case None => {
                <span class="glyphicon glyphicon-minus archived"></span>
            }
        }
    </td>
    @for(x <- 1 until Environment.values.length){
        <td></td>
    }
}

@environmentStatusCheck(statusCheck: String, statusCheckMap: Map[Environment, StatusCheck]) = {
    <td>@statusCheck</td>

    @statusCheckMap.toSeq.sortBy(_._1).map { kvp =>
        <td style="text-align: center">
            @kvp match {
                case (Integration, StatusCheck(None))  => {
                    <ul class="list-compact">
                        <li>@Integration</li>
                        <li><span class="glyphicon glyphicon-remove archived"></span>[default off]</li>
                    </ul>
                }
                case (env, StatusCheck(Some(evidence))) => {
                    <ul class="list-compact">
                        <li>@env</li>
                        <li><span class="glyphicon glyphicon-ok low"></span> <a href="@evidence" target="_blank" rel="noopener noreferrer">[view]</a></li>
                    </ul>
                }
                case (env, StatusCheck(None)) => {
                    <ul class="list-compact">
                        <li>@env</li>
                        <li><span class="glyphicon glyphicon-minus archived"></span></li>
                    </ul>
                }
            }
        </td>
    }
}
