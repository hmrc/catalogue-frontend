@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.cataloguefrontend.servicecommissioningstatus.ServiceCommissioningStatus
@import uk.gov.hmrc.cataloguefrontend.servicecommissioningstatus.StatusCheck
@import uk.gov.hmrc.cataloguefrontend.model.Environment
@import uk.gov.hmrc.cataloguefrontend.model.Environment.Integration

@this()

@(status: ServiceCommissioningStatus
)(implicit
  messages: Messages,
  request: Request[_]
)
    @standard_layout("Service-Commissioning-Status") {
        <header>
            <h1>Service Commissioning Status</h1>
        </header>

        <h2>@status.serviceName</h2>

        <table class="table table-striped">
            <thead>
                <tr>
                    <th class="col-lg-3">Check</th>
                    <th colspan="6">Status</th>
                </tr>
            </thead>
            <tbody>
                <tr>@check("Github Repo",               "https://build.tax.service.gov.uk/job/PlatOps/job/Tools/job/create-a-repository/", status.hasRepo.evidence)</tr>
                <tr>@check("App Config Base",           "https://github.com/hmrc/app-config-base",                                         status.hasAppConfigBase.evidence)</tr>
                <tr>@envCheck("App Config Environment", "https://github.com/hmrc/app-config-$env",                                         status.hasAppConfigEnv)</tr>
                <tr>@envCheck("Frontend Routes",        "https://github.com/hmrc/mdtp-frontend-routes/$env",                               status.hasFrontendRoutes)</tr>
                <tr>@check("Build Jobs",                "https://github.com/hmrc/build-jobs",                                              status.hasBuildJobs.evidence)</tr>
                <tr>@check("Service Manager Config",    "https://github.com/hmrc/service-manager-config",                                  status.hasSMConfig.evidence)</tr>
                <tr>@envCheck("Deployed",               "https://orchestrator.tools.$env.tax.service.gov.uk/job/deploy-microservice/",     status.isDeployed)</tr>
                <tr>@check("Kibana",                    "https://github.com/hmrc/kibana-dashboards",                                       status.hasDashboards.grafana.evidence)</tr>
                <tr>@check("Grafana",                   "https://github.com/hmrc/grafana-dashboards",                                      status.hasDashboards.grafana.evidence)</tr>
                <tr>@check("Alerts",                    "https://github.com/hmrc/alert-config",                                            status.hasAlerts.evidence)</tr>
            </tbody>
        </table>
    }

@check(statusCheck: String, addHereUrl: String, evidence: Option[String]) = {
    <td>@statusCheck</td>
    <td>
        @evidence match {
            case Some(evidence) => {
                <a href="@evidence" target="_blank" rel="noopener noreferrer">
                    <span style="width: 32px" class="glyphicon glyphicon-ok low"></span>
                    view
                </a>
            }
            case None => {
                <a href="@addHereUrl" target="_blank" rel="noopener noreferrer">
                    <span style="width: 32px" class="glyphicon glyphicon-minus archived"></span>
                    add
                </a>
            }
        }
    </td>
    @Environment.values.drop(1).map(_ => <td></td>)
}

@envCheck(statusCheck: String, addHereUrl: String, statusCheckMap: Map[Environment, StatusCheck]) = {
    <td>@statusCheck</td>

    @statusCheckMap.toSeq.sortBy(_._1).map { kvp =>
        <td>
            @kvp match {
                case (env, StatusCheck(Some(evidence))) => {
                    <ul class="list-compact">
                        <li>@env</li>
                        <li>
                            <a href="@evidence" target="_blank" rel="noopener noreferrer">
                                <span style="width: 32px" class="glyphicon glyphicon-ok low"></span>
                                view
                            </a>
                        </li>
                    </ul>
                }
                case (env, StatusCheck(None)) => {
                    <ul class="list-compact">
                        <li>@env</li>
                        <li>
                            <a href="@addHereUrl.replaceAll("\\$env", env.toString.toLowerCase)" target="_blank" rel="noopener noreferrer">
                                <span style="display: inline-block; width: 32px" class="glyphicon glyphicon-minus archived"></span>
                                add
                            </a>
                    </ul>
                }
            }
        </td>
    }
}
