@*
 * Copyright 2018 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import partials.DependenciesPartial
@import uk.gov.hmrc.cataloguefrontend.ViewMessages
@import uk.gov.hmrc.cataloguefrontend.service.ConfigService._
@import uk.gov.hmrc.cataloguefrontend.service.ConfigService.ConfigByKeyEntry
@import scala.collection.immutable.ListMap

@this(dependenciesPartial: DependenciesPartial, viewMessages: ViewMessages)
@(serviceName: String, configByEnvironment: ConfigByEnvironment, configByKey: ConfigByKey)(implicit messages: Messages, request: Request[_])
<html>
    <head>
        <link rel="stylesheet" href="@routes.Assets.at("config-explorer.css")" />
        <script src="@routes.Assets.at("split.js")"></script>
        <script src="@routes.Assets.at("config-explorer.js")"></script>
    </head>
    <body>
        <header class="opaque">
            <h1 id="service-header">Config: @serviceName</h1>
        </header>
        <section>
            <div class="grid-container explorer-grid">
                <div class="grid-header">
                    <div id="header-0" class="grid-item sticky-column truncate-content">Key</div>
                    @for((env, index) <- environments.zipWithIndex) {
                        <div class="gutter gutter-horizontal"></div>
                        <div id="header-@{index + 1}" class="grid-item truncate-content">@env</div>
                    }
                </div>
                @for((key: String, entries: List[ConfigByKeyEntry]) <- ListMap(configByKey.toMap.toSeq.sortWith(_._1 < _._1):_*)) {
                    <div class="grid-row">
                        <div class="grid-item sticky-column truncate-content">@key</div>
                        @for(env <- environments) {
                            <div class="grid-item truncate-content">
                                <ul>
                                @for(entry: ConfigByKeyEntry <- sortBySourcePrecedence(filterForEnv(env, entries))) {
                                    <li><a target="raw" href="config/raw#@env-@entry.configSource-@key">@entry.value</a></li>
                                }
                                </ul>
                            </div>
                        }
                    </div>
                }
            </div>
        </section>
        <script type="text/javascript">
            ready(function() {
                Split(["#header-0", "#header-1", "#header-2", "#header-3", "#header-4", "#header-5", "#header-6", "#header-7"], {
                    sizes: [300, 500, 500, 500, 500, 500, 500, 500]
                })
            });
        </script>
    </body>
</html>