@*
 * Copyright 2018 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import partials.DependenciesPartial
@import uk.gov.hmrc.cataloguefrontend.ViewMessages
@import uk.gov.hmrc.cataloguefrontend.service.ConfigService._

@this(dependenciesPartial: DependenciesPartial, viewMessages: ViewMessages)
@(serviceName: String, configByEnvironment: ConfigByEnvironment, configByKey: ConfigByKey)(implicit messages: Messages, request: Request[_])

    <style type="text/css" media="screen">

            table > tbody > tr > td:first-child {
                white-space: nowrap;
                text-overflow: ellipsis;
                overflow-x: hidden;
            }

            div.scroll-x {
                overflow-x: scroll;
            }

            .tooltip {
                position: relative;
                display: inline-block;
            }

            /* Tooltip text */
            .tooltip .tooltiptext {
                visibility: hidden;

                width: 120px;
                top: 100%;
                left: 50%;
                margin-left: -60px;
                background-color: black;

                color: #fff;
                text-align: center;
                padding: 5px 0;
                border-radius: 6px;

                /* Position the tooltip text - see examples below! */
                position: absolute;
                z-index: 1;
            }

            /* Show the tooltip text when you mouse over the tooltip container */
            .tooltip:hover .tooltiptext {
                visibility: visible;
            }

    </style>

    @repeatText(v: Seq[EnvironmentConfigSource]) = @{
        v.foldLeft("Repeated in ") { case (s, (env, source)) => s"$s ${env.name} ${source.toString}" }
    }

    @printMap(envSource: EnvironmentConfigSource) = {
        @for((k, v, repeats) <- prepareMapForPrint(configByEnvironment, configByKey, envSource)) {
            @if(repeats.nonEmpty) {
                <tr>
                    <td class="configTable repeat">
                        <div class="tooltip">
                            <span class="tooltiptext">@{
                                repeatText(repeats)
                            }</span>
                            @k
                        </div>
                    </td><td class="repeat">@v.value</td>
                </tr>
            } else {
                <tr><td>@k</td><td>@v.value</td></tr>
            }
        }
    }

    @print

@standard_layout(serviceName, "configuration") {

    <header class="header-with-github-badge">
        <div>
            <h1 id="service-header">Config: @serviceName</h1>
        </div>
    </header>

    <h3>
        Internal Application Config - <a href="https://www.github.com/hmrc/@serviceName/blob/master/conf/application.conf">@serviceName/conf/application.conf</a>
    </h3>
    <div class="scroll-x">
        <table class="table table-striped">
           <tbody>
               <tr><th>Key</th><th>Value</th></tr>
            @printMap((Service, ApplicationConf))
           </tbody>
        </table>
    </div>
    <h3>
        'base' Config - <a href="https://www.github.com/hmrc/app-config-base/blob/master/@{serviceName}.conf">app-config-base</a>
    </h3>
    <div class="scroll-x">
        <table class="table table-striped">
            <tbody>
                <tr><th>Key</th><th>Value</th></tr>
                @printMap((Base, BaseConfig))
            </tbody>
        </table>
    </div>
    @for(env <- environments) {
        <h2>@env.name Config</h2>
        <h3>
            <a href="https://www.github.com/hmrc/app-config-common/blob/master/@env-frontend-common.yaml">common overridable</a>
        </h3>
        <p>These settings are common to all services of this type in this environment</p>
        <div class="scroll-x">
            <table class="table table-striped">
                <tbody>
                    <tr><th>Key</th><th>Value</th></tr>
                    @printMap((env, AppConfigCommonOverridable))
                </tbody>
            </table>
        </div>

        <h3>
            <a href="https://www.github.com/hmrc/app-config-@env/blob/master/@{serviceName}.yaml">app specific</a>
        </h3>
        <div class="scroll-x">
            <table class="table table-striped">
                <tbody>
                    <tr><th>Key</th><th>Value</th></tr>
                    @printMap((env, AppConfig))
                </tbody>
            </table>
        </div>

        <h3>
            <a href="https://www.github.com/hmrc/app-config-common/blob/master/@env-frontend-common.yaml">common fixed</a>
        </h3>
        <p>These settings are common to all services of this type in this environment</p>
        <div class="scroll-x">
            <table class="table table-striped">
                <tbody>
                    <tr><th>Key</th><th>Value</th></tr>
                    @printMap((env, AppConfigCommonFixed))
                </tbody>
            </table>
        </div>
    }
}