@*
 * Copyright 2018 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import partials.DependenciesPartial
@import uk.gov.hmrc.cataloguefrontend.ViewMessages
@import uk.gov.hmrc.cataloguefrontend.service.ConfigService._
@import scala.collection.immutable.ListMap

@this(dependenciesPartial: DependenciesPartial, viewMessages: ViewMessages)
@(serviceName: String, configByKey: ConfigByKey)(implicit messages: Messages, request: Request[_])
<html>
    <head>
        <link rel="stylesheet" href="@routes.Assets.at("config-explorer.css")" />
        <script src="@routes.Assets.at("split.js")"></script>
        <script src="@routes.Assets.at("config-explorer.js")"></script>
    </head>
    <body>
        <header class="opaque">
            <h1 id="service-header">Config: @serviceName</h1>
            <i class="glyphicon glyphicon-menu-hamburger menu-icon"></i>
        </header>
        <section>
            <div class="grid-container explorer-grid">
                <div class="grid-header">
                    <div id="header-0" class="grid-item sticky-column truncate-content">Key</div>
                    <div class="gutter gutter-horizontal"></div>
                    @for((env, index) <- environments.zipWithIndex) {
                        <div id="header-@{index + 1}" class="grid-item truncate-content column-@env">@env</div>
                        <div class="gutter gutter-horizontal column-@env"></div>
                    }
                </div>
                @for((key: String, envSources: Map[String, Seq[ConfigSourceValue]]) <- ListMap(configByKey.toSeq.sortWith(_._1 < _._1):_*)) {
                    <div class="grid-row">
                        <div class="grid-item sticky-column truncate-content">@key</div>
                        @for(env <- environments) {
                            <div class="grid-item column-@env">
                                <ul>
                                @for(sourceValue: ConfigSourceValue <- sortBySourcePrecedence(envSources.get(env))) {
                                    <li title="@friendlySourceName(sourceValue.source, env)">
                                        <span class="truncate-content">@sourceValue.value</span>
                                        <a class="glyphicon glyphicon-circle-arrow-right" target="raw" href="config/raw#@env-@sourceValue.source-@key"></a>
                                    </li>
                                }
                                </ul>
                            </div>
                        }
                    </div>
                }
            </div>
        </section>
        <aside>
            <h2>Columns</h2>
            <ul>
                @for(env <- environments) {
                    <li>
                        <input class="column-filter" type="checkbox" id="show-@env" checked="checked" />
                        <label for="show-@env">@env</label>
                    </li>
                }
            </ul>
        </aside>
        <script type="text/javascript">
            ready(function() {
                Split(["#header-0", "#header-1", "#header-2", "#header-3", "#header-4", "#header-5", "#header-6", "#header-7"], {
                    sizes: [300, 500, 500, 500, 500, 500, 500, 500]
                });

                document.querySelector(".menu-icon").addEventListener("click", e => {
                    document.querySelector("body").classList.toggle("sidebar-open");
                });

                Array.from(document.querySelectorAll(".column-filter")).forEach(input => {
                    const env = input.id.replace("show-", "");
                    input.addEventListener("change", e => {
                        Array.from(document.getElementsByClassName(`column-${env}`)).forEach(item => {
                            item.classList.toggle("hidden");
                        });
                    });
                });
            });
        </script>
    </body>
</html>