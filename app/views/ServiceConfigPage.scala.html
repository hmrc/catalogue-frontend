@*
 * Copyright 2018 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import partials.DependenciesPartial
@import uk.gov.hmrc.cataloguefrontend.ViewMessages
@import uk.gov.hmrc.cataloguefrontend.service.ConfigService._
@import uk.gov.hmrc.cataloguefrontend.service.ConfigService.ConfigByKeyEntry

@this(dependenciesPartial: DependenciesPartial, viewMessages: ViewMessages)
@(serviceName: String, configByEnvironment: ConfigByEnvironment, configByKey: ConfigByKey)(implicit messages: Messages, request: Request[_])

    <style type="text/css">

        body {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        table > tbody > tr > td:first-child {
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow-x: hidden;
        }

        table.table > tbody > tr > td {
            max-width: 50em;
            text-overflow: ellipsis;
            overflow-x: hidden;
            white-space: nowrap;
            overflow-wrap: break-word;
            padding: 0 1em 0 0;

            font-family: monospace ;
        }

        table td ul {
            margin: 0;
            padding: 0;
        }

        table td li {
            text-overflow: ellipsis;
            overflow-x: hidden;
            text-decoration: line-through;
        }

        table td li:last-child {
            text-decoration: none;
        }

        nav {
            flex: auto 0 0;
        }

        section.container {
            display: flex;
            flex-direction: column;
        }

        .scroll-container {
            flex: 1 1 auto;
            overflow-x: scroll;
            overflow-y: scroll;
        }

        /* Show the tooltip text when you mouse over the tooltip container */
        .tooltip:hover .tooltiptext {
            visibility: visible;
        }

    </style>


@*
    @repeatText(v: Seq[EnvironmentConfigSource]) = @{
        v.foldLeft("Repeated in ") { case (s, (env, source)) => s"$s ${env.name} ${source.toString}" }
    }
*@



    @printComparison() = {
        @for((key: String, entries: List[ConfigByKeyEntry]) <- configByKey) {
            <tr>
                <td>@key</td>
                @for(env <- environments) {
                <td>
                    <ul>
                    @for(entry: ConfigByKeyEntry <- sortBySourcePrecedence(filterForEnv(env, entries))) {
                        <li>@entry.configSource: @entry.value</li>
                    }
                    </ul>
                </td>
                }
            </tr>
        }
    }

@standard_layout(serviceName, "configuration") {

    <header class="header-with-github-badge">
        <div>
            <h1 id="service-header">Config: @serviceName</h1>
        </div>
    </header>

    <div class="scroll-container">
        <table class="table table-striped">
           <thead>
               <tr>
                   <th>Key</th>
                   @for(env <- environments) {
                       <th>@env</th>
                   }
               </tr>
            </thead>
            <tbody>
                @printComparison()
           </tbody>
        </table>
    </div>









    @{/* <h3>
        Internal Application Config - <a href="https://www.github.com/hmrc/@serviceName/blob/master/conf/application.conf">@serviceName/conf/application.conf</a>
    </h3>
    <div class="scroll-x">
        <table class="table table-striped">
           <tbody>
               <tr><th>Key</th><th>Value</th></tr>
            @printMap((Service, ApplicationConf))
           </tbody>
        </table>
    </div>
    <h3>
        'base' Config - <a href="https://www.github.com/hmrc/app-config-base/blob/master/@{serviceName}.conf">app-config-base</a>
    </h3>
    <div class="scroll-x">
        <table class="table table-striped">
            <tbody>
                <tr><th>Key</th><th>Value</th></tr>
                @printMap((Base, BaseConfig))
            </tbody>
        </table>
    </div>
    @for(env <- environments) {
        <h2>@env.name Config</h2>
        <h3>
            <a href="https://www.github.com/hmrc/app-config-common/blob/master/@env-frontend-common.yaml">common overridable</a>
        </h3>
        <p>These settings are common to all services of this type in this environment</p>
        <div class="scroll-x">
            <table class="table table-striped">
                <tbody>
                    <tr><th>Key</th><th>Value</th></tr>
                    @printMap((env, AppConfigCommonOverridable))
                </tbody>
            </table>
        </div>

        <h3>
            <a href="https://www.github.com/hmrc/app-config-@env/blob/master/@{serviceName}.yaml">app specific</a>
        </h3>
        <div class="scroll-x">
            <table class="table table-striped">
                <tbody>
                    <tr><th>Key</th><th>Value</th></tr>
                    @printMap((env, AppConfig))
                </tbody>
            </table>
        </div>

        <h3>
            <a href="https://www.github.com/hmrc/app-config-common/blob/master/@env-frontend-common.yaml">common fixed</a>
        </h3>
        <p>These settings are common to all services of this type in this environment</p>
        <div class="scroll-x">
            <table class="table table-striped">
                <tbody>
                    <tr><th>Key</th><th>Value</th></tr>
                    @printMap((env, AppConfigCommonFixed))
                </tbody>
            </table>
        </div>
    }
    */}
}