@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.cataloguefrontend.vulnerabilities.{TotalVulnerabilityCount, routes => appRoutes}
@import uk.gov.hmrc.cataloguefrontend.model.Environment.{Development, Integration}
@import uk.gov.hmrc.cataloguefrontend.model.Environment
@import views.html.helper.checkbox
@import uk.gov.hmrc.cataloguefrontend.vulnerabilities.VulnerabilitiesCountFilter

@this()


@(vulnerabilities: Seq[TotalVulnerabilityCount],
  form           : Form[VulnerabilitiesCountFilter]
)(implicit
  messages: Messages,
  request: Request[_]
)

@standard_layout(s"service vulnerabilities") {
    <header>
        <h1>Service Vulnerabilities</h1>
    </header>
        <div id="counts">
            <form id="form" method="get">
                <div class="form-row">
                    <div class="col-md-5">
                        <div class="form-group">
                            <label for="search">Service</label>
                            <input class="search form-control" type="text" id="service" name="service" value="@form("service").value">
                        </div>
                    </div>
                </div>

                <div class="col-md-3 form-horizontal">
                    <label>Show number of vulnerabilities in:</label>
                    <div>
                        <input name="production" id="production" type="checkbox" value="true" onchange="form.submit()" @if(form.value.exists(_.production)){checked="checked"}>
                        @Environment.Production.displayString
                    </div>

                    <div>
                        <input name="staging" id="staging" type="checkbox" value="true" onchange="form.submit()" @if(form.value.exists(_.staging)){checked="checked"}>
                        @Environment.Staging.displayString
                    </div>

                    <div>
                        <input name="qa" id="qa" type="checkbox" value="true" onchange="form.submit()" @if(form.value.exists(_.qa)){checked="checked"}>
                        @Environment.QA.displayString
                    </div>

                    <div>
                        <input name="externalTest" id="externalTest" type="checkbox" value="true" onchange="form.submit()" @if(form.value.exists(_.externalTest)){checked="checked"}>
                        @Environment.ExternalTest.displayString
                    </div>
                </div>
            </form>
        </div>


    <div id="service-list">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th class="col-xs-6"><button class="sort no-border" data-sort="service">Service</button></th>
                    <th class="col-xs-2 text-center"><button class="no-border">Action Required</button></th>
                    <th class="col-xs-2 text-center"><button class="no-border">Under Investigation</button></th>
                    <th class="col-xs-2 text-center"><button class="no-border">No Action Required</button></th>
                </tr>
            </thead>
            <tbody class="list">
            @vulnerabilities.map(vulnerabilitiesCountForService)
            </tbody>
        </table>
    </div>
}


@vulnerabilitiesCountForService(totalVulnerabilityCount: TotalVulnerabilityCount) = {
    <tr>
        <td>@totalVulnerabilityCount.service</td>
        <td class="text-center">@totalVulnerabilityCount.actionRequired</td>
        <td class="text-center">@totalVulnerabilityCount.investigationOngoing</td>
        <td class="text-center">@totalVulnerabilityCount.noActionRequired</td>
    </tr>
}

@envCheckBox(env: Environment) = {
    <div>
        <input name="@env" id="@env" type="checkbox" value="true" onchange="form.submit()" @if(form.value.exists(_.production)){checked="checked"}>
        @env.displayString
    </div>

}