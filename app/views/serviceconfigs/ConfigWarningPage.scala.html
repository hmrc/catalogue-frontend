@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.cataloguefrontend.model.Environment
@import uk.gov.hmrc.cataloguefrontend.connector.GitRepository
@import views.html.helper
@import views.html.partials.form_global_errors
@import uk.gov.hmrc.cataloguefrontend.{ routes => appRoutes }
@import uk.gov.hmrc.cataloguefrontend.serviceconfigs.{ConfigWarning, ServiceConfigsService, routes => serviceConfigsRoutes }

@this()

@(form          : Form[ConfigWarning.ConfigWarningForm],
  allServices   : Seq[GitRepository],
  configWarnings: Option[Seq[ServiceConfigsService.ConfigWarning]] = None
)(implicit
  messages: Messages,
  request : RequestHeader
)

@standard_layout("Config Warnings") {
    <header>
        <h1>
            Search Warning
        </h1>
    </header>

    @helper.form(
        action          =  serviceConfigsRoutes.ServiceConfigsController.configWarningsResults(),
        Symbol("id")    -> "form",
        Symbol("class") -> "form-group"
    ) {
        <div class="row">
            <div class="col-md-4">
                @helper.select(
                    field              = form("serviceName"),
                    options            = allServices.map(t => t.name -> t.name),
                    Symbol("_label")   -> "Service",
                    Symbol("id")       -> "service-filter",
                    Symbol("class")    -> "form-control",
                )
            </div>
            <div class="col-md-2">
                <dl>
                    <dt><label>Environments</label></dt>
                    <dd>
                        @for(env <-  Environment.values) {
                            <div class="checkbox-group">
                                <input name="showEnvironments[]" id="@{env.asString}-checkbox" type="checkbox" value="@env.asString" @if(scala.util.Try(form.get.showEnvironments).getOrElse(Environment.values).contains(env)) {checked} />
                                <label for="@{env.asString}-checkbox">@env.displayString</label>
                            </div>
                        }
                    </dd>
                </dl>
            </div>
        </div>
    }

    @if(configWarnings.filter(_.nonEmpty).isEmpty) {
        <p>No results found.</p>
    } else {
        <table class="table table-striped always-wrap sticky-header" style="table-layout:fixed">
            <thead>
                <tr>
                    <th>@if(configWarnings.isDefined) {Key} else {Service}</th>
                    @for(env <- form.get.showEnvironments) {
                        <th id="@{env.asString}-tr">@env.displayString</th>
                    }
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
    }

    <script @CSPNonce.attr src="@routes.Assets.versioned("search-with-autocomplete.js")"></script>
    <script @CSPNonce.attr>
        document
            .getElementById('service-filter')
            .addEventListener("change", () => {
                document.getElementById("form").submit();
            });
    </script>
}
