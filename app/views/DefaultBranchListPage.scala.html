@*
* Copyright 2021 HM Revenue & Customs
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*     http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*@

@import play.api.mvc.Call
@import uk.gov.hmrc.cataloguefrontend.DateHelper._
@import uk.gov.hmrc.cataloguefrontend.connector.RepositoryDisplayDetails
@import uk.gov.hmrc.cataloguefrontend.ViewMessages
@import helper._

@this(viewMessages: ViewMessages)

@(repositories: Seq[RepositoryDisplayDetails],
form: Form[_]
)(implicit messages: Messages, request: Request[_])

@standard_layout(s"Default Branches", "defaultbranch") {
<header>
    <h1>Default Branch</h1>
</header>

@if(form.hasErrors) {
<div class="alert alert-danger" role="alert">
    <ul class="list">
        @form.errors.map { error =>
        <li class="alert-danger"> @Messages(error.message, error.args: _*)</li>
        }
    </ul>
</div>
}

<div id="default-branches">
    <form action="/defaultbranch" method="get">
        <div class="form-group row">
            <div class="col-xs-1 padding-reset-right">
                <label for="search">Name:</label>
            </div>
            <div class="col col-xs-3">
                <input class="search form-control" id="search" type="text" name="name" value='@form("name").value' autofocus>
            </div>
            <div class="col-xs-1 padding-reset-right">
                <label for="teamNames">Team:</label>
            </div>
            <div class="col col-xs-3">
                <input class="search form-control" id="teamNames" type="text" name="teamNames" value='@form("teamNames").value' autofocus>
            </div>
            <div class="col-xs-1 padding-reset-right">
                <label for="defaultBranch">Branch:</label>
            </div>
            <div class="col col-xs-3">
                <input class="search form-control" id="defaultBranch" type="text" name="defaultBranch" value='@form("defaultBranch").value' autofocus>
            </div>
        </div>
    </form>
    <table class="table table-striped">
        <tr>
            <th class="col-lg-6"><button role="button" class="sort no-border" data-sort="repo-name">Name</button></th>
            <th class="col-lg-6"><button role="button" class="sort no-border" data-sort="teamNames">Team/s</button></th>
            <th class="col-lg-6"><button role="button" class="sort no-border" data-sort="defaultBranch">Default Branch</button></th>
            <th class="col-lg-6"><button role="button" class="sort no-border" data-sort="archived">Archived</button></th>
        </tr>
        <tbody class="list">
        @repositories.zipWithIndex.map{case (repo, i) =>
        <tr id="row@i">
            <td class="service-name" id="row@{i}_name">
                <a class="repo-name" href="@uk.gov.hmrc.cataloguefrontend.routes.CatalogueController.repository(repo.name)">@repo.name</a>
            </td>
            <td class="teamNames monospaced" id="row@{i}_teamNames">
                @if(repo.teamNames.length > 0 && repo.teamNames.length <= 6) { @for(name <- repo.teamNames) {
                            @if(name == repo.teamNames.last) { @name } else { @name, }
                        }
                    } else if (repo.teamNames.length > 6)  {
                        <i>Various Teams</i>
                    } else {
                            @repo.teamNames
                    }
            </td>
            <td class="defaultBranch monospaced" id="row@{i}_defaultBranch">
                @repo.defaultBranch
            </td>
            <td class="archived monospaced" id="row@{i}_archived">
                @repo.archived
            </td>
        </tr>
        }
        </tbody>
    </table>
</div>
}

<!-- listjs configuration -->
<script>
    var options = { valueNames: [ 'service-name', 'repo-name', 'teamNames', 'defaultBranch', 'archived'],
                    searchColumns: ['repo-name', 'teamNames', 'defaultBranch', 'archived'] };

    var serviceList = new List('default-branches', options);
</script>
