@*
 * Copyright 2019 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.cataloguefrontend.ViewMessages
@import uk.gov.hmrc.cataloguefrontend.service.ServiceDependencies
@import uk.gov.hmrc.cataloguefrontend.service.ServiceDependency
@import uk.gov.hmrc.cataloguefrontend.service.DependenciesService
@import uk.gov.hmrc.cataloguefrontend.connector.model.JDKVersion
@import uk.gov.hmrc.cataloguefrontend.connector.SlugInfoFlag
@import play.twirl.api.Html
@import uk.gov.hmrc.cataloguefrontend.routes

@this(viewMessages: ViewMessages)

@(jdkVersions: List[JDKVersion],
  flags:       Seq[SlugInfoFlag],
  selected:    SlugInfoFlag)(implicit request: Request[_])

@standard_layout(s"JDK Versions", "dependencies") {
    <header>
        <h1 id="jdk-header">JDK Versions: @selected.s</h1>

        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    </header>

    <div id="chart_div"></div>
    <hr>
    <div>
    <form class="form-inline">
        <div class="form-inline">
            <label for="flag">Environment:</label>
            <select name="flag">
            @flags.map(flagSelect)
            </select>

            <input class="btn btn-primary" type="submit"/>
        </div>
    </form>
    </div>
    <div>
        <table class="table table-striped" id="jdk-table">
            <thead>
                <tr>
                    <th>Service</th>
                    <th>JDK Version</th>
                </tr>
            </thead>
            <tbody>
                @jdkVersions.map(jdkVersion)
            </tbody>
        </table>

    </div>

    <script type="text/javascript">
            google.charts.load('current', {'packages': ['corechart']});
            google.charts.setOnLoadCallback(drawChart);
            function drawChart() {

                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Version');
                data.addColumn('number', 'Count');
                data.addRows([
                    @for(r <- jdkVersions.groupBy(_.version).mapValues(_.length)) {
                    ['JDK @r._1', @r._2],
                    }
                ].sort());

                var options = { 'title'    : 'JDK Usage',
                    'width'    : "80%",
                    'height'   : 200,
                    'chartArea': { 'width': '100%',
                        'height': '100%'}};
                var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
                chart.draw(data, options);
            }

    </script>
}

@jdkVersion(version: JDKVersion) = {
    <tr id="jdk-slug-@version.name">
        <td><a href="@routes.CatalogueController.repository(version.name)">@version.name</a></td>
        <td>@version.version</td>
    </tr>
}

@flagSelect(flag: SlugInfoFlag) = {
    <option value=@{flag.s.toLowerCase.trim} @{if(flag == selected) "selected"}>
        @flag.s.trim
    </option>
}