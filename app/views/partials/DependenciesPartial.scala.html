@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.cataloguefrontend.ViewMessages
@import uk.gov.hmrc.cataloguefrontend.connector.model._

@this(viewMessages: ViewMessages)

@(
  dependencies: Seq[Dependency],
  rootId      : String,
  title       : String,
  serviceName : String,
  version     : Option[Version],
  isSub       : Boolean         = false,
  showLegend  : Boolean         = true
)

<div id="@rootId" class="card mb-3">
    <div class="card-header">
      <h4 class="mb-0">@title</h4>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-9">
                @if(dependencies.nonEmpty) {
                    <div class="row">
                        <div class="col-4">
                            <p class="fw-bold">Libraries</p>
                        </div>
                        <div class="col-3">
                            <p class="fw-bold">Current Version</p>
                        </div>
                        <div class="col-3">
                            <p class="fw-bold">Latest Version</p>
                        </div>
                        <div class="col-2">
                            <p class="fw-bold">Violation</p>
                        </div>
                    </div>
                    @partials.dependency_section(dependencies, rootId)
                } else {
                    <p class="card-text dependency-row">No dependencies available</p>
                }
            </div>
            @if(dependencies.nonEmpty && showLegend) {
                <div class="col-3">
                    @partials.dependency_legend(showNewVersionAvailable = true)
                </div>
            }
        </div>
        <div class="row">
            <div class="col-3 offset-9">
                @if(dependencies.headOption.exists(_.scope.isDefined)) {
                    @version.map(ver => graphLink(ver, dependencies.head.scope))
                }
                @* Only show the dependencies link for compile scope for now (we'd need to extend the page to support other scopes *@
                @if(dependencies.headOption.exists(_.scope.contains(DependencyScope.Compile))){
                    <br/>@version.map(ver => dependenciesLink(ver))
                }
            </div>
        </div>
    </div>
</div>

@graphLink(v: Version, scope: Option[DependencyScope]) = {
  <a id="@rootId-view-dependency-graph" href="@uk.gov.hmrc.cataloguefrontend.routes.DependenciesController.graphs(serviceName, v.toString, scope.map(_.asString).getOrElse(DependencyScope.Compile.asString))">View Dependency Graph</a>
}

@dependenciesLink(v: Version) = {
  <a id="@rootId-view-dependency-list" href="@uk.gov.hmrc.cataloguefrontend.routes.DependenciesController.service(serviceName, v.toString)">View Dependency List</a>
}
