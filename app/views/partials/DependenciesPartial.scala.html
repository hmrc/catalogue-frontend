@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.cataloguefrontend.ViewMessages
@import uk.gov.hmrc.cataloguefrontend.connector.model._

@this(viewMessages: ViewMessages)

@(
  dependencies: Seq[Dependency],
  rootId      : String,
  title       : String,
  serviceName : String,
  version     : Option[Version],
  isSub       : Boolean         = false
)(implicit messages: Messages)

<div id="@rootId" class="board">
  <h3 class="board__heading @if(isSub){sub_board}">
    @title
  </h3>
  <div class="board__body">
    <div class="col-xs-9">
      <ul class="list list--minimal list-group row">
        @if(dependencies.nonEmpty) {
          <li>
            <span class="col-xs-4"><label>Libraries</label></span>
            <span class="col-xs-3"><label>Current Version</label></span>
            <span class="col-xs-3"><label>Latest Version</label></span>
            <span class="col-xs-2"><label>Violation</label></span>
          </li>
          @partials.dependency_section(dependencies)
        } else {
          <li>No dependencies available</li>
        }
      </ul>
    </div>
    @if(dependencies.nonEmpty) {
      <div class="col-xs-3">
        @partials.dependency_legend(showNewVersionAvailable = true)
      </div>
    }

    <div class="row">
      <div class="col-xs-3 col-xs-offset-9">
        @if(dependencies.headOption.exists(_.scope.isDefined)) {
          @version.map(ver => graphLink(ver, dependencies.head.scope))
        }
        @* Only show the dependencies link for compile scope for now (we'd need to extend the page to support other scopes *@
        @if(dependencies.headOption.exists(_.scope.contains(DependencyScope.Compile))){
          <br/>@version.map(ver => dependenciesLink(ver))
        }
      </div>
    </div>
  </div>
</div>

@graphLink(v: Version, scope: Option[DependencyScope]) = {
  <a href="@uk.gov.hmrc.cataloguefrontend.routes.DependenciesController.graphs(serviceName, v.toString, scope.map(_.asString).getOrElse(DependencyScope.Compile.asString))">View Dependency Graph</a>
}

@dependenciesLink(v: Version) = {
  <a href="@uk.gov.hmrc.cataloguefrontend.routes.DependenciesController.service(serviceName, v.toString)">View Dependency List</a>
}
