@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.twirl.api.TwirlFeatureImports.defining
@import uk.gov.hmrc.cataloguefrontend.viewModels.{EnvironmentWithVersion, EnvironmentWithoutVersion, VersionViewModel}
@import uk.gov.hmrc.cataloguefrontend.{routes => appRoutes}

@(viewModel: VersionViewModel)

<tbody class="list">
@viewModel.toRows.map { row =>
  <tr id="row@{row.index}">
    <td class="application-name" id="row@{row.index}_application">
        <a id="link-to-info-page-for-@{row.applicationName}" href="@appRoutes.CatalogueController.service(row.applicationName)">@{row.applicationName}</a>
    </td>

    @row.environments.map {
        case EnvironmentWithVersion(env, version) => {
            @if(version.versionNumber.asVersion == row.latestVersion) {
                <td id="row@{row.index}_version_@{env.asString}">@version.versionNumber.asString</td>
            } else {
                @defining(row.uniqueVersions.indexOf(version.versionNumber.asVersion)) { age =>
                    @defining((1 - (age.toDouble / row.uniqueVersions.length)) * 0.75) { opacity =>
                        <td id="row@{row.index}_version_@{env.asString}" class="wrw-version-outdated" style="--bs-bg-opacity: @opacity">
                        @version.versionNumber.asString
                        </td>
                    }
                }
            }
        }
        case EnvironmentWithoutVersion(env) => {
            <td id="row@{row.index}_version_@{env.asString}"></td>
        }
    }
    <td>
        <a id="link-to-deployment-timeline-for-@{row.applicationName}" href="@uk.gov.hmrc.cataloguefrontend.whatsrunningwhere.routes.DeploymentHistoryController.graph(row.applicationName) "><span class="glyphicon glyphicon-stats"></span> </a>
    </td>
  </tr>
}
</tbody>

