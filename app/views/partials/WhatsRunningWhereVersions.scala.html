@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.cataloguefrontend.viewModels.whatsRunningWhere.{EnvironmentWithVersion, EnvironmentWithoutVersion, VersionRow}
@import uk.gov.hmrc.cataloguefrontend.{routes => appRoutes}

@(rows: Seq[VersionRow])

<tbody class="list">
@rows.map { row =>
  <tr id="row@{row.index}">
    <td class="application-name" id="row@{row.index}_application">
        <a id="link-to-info-page-for-@{row.applicationName}" href="@appRoutes.CatalogueController.service(row.applicationName)">@{row.applicationName}</a>
    </td>

    @row.environments.map {
        case environmentWithVersion: EnvironmentWithVersion => {
        @if(environmentWithVersion.version.versionNumber.asVersion == row.latestVersion && !environmentWithVersion.isPatchedVersion) {
            <td id="row@{row.index}_version_@{environmentWithVersion.env.asString}">@environmentWithVersion.version.versionNumber.asString</td>
        } else {
            <td id="row@{row.index}_version_@{environmentWithVersion.env.asString}"
                class="@if(environmentWithVersion.isPatchedVersion) {wrw-version-outdated-patch} else {wrw-version-outdated}"
                style="--bs-bg-opacity: @if(environmentWithVersion.isPatchedVersion) {0.75} else {@row.versionOpacity(environmentWithVersion.version.versionNumber.asVersion)}">
                <span
                    data-bs-toggle="popover"
                    data-bs-trigger="hover"
                    data-bs-placement="bottom"
                    data-bs-html="true"
                    data-bs-title='@{environmentWithVersion.toolTipContent(row.latestVersion)}'
                >
                @environmentWithVersion.version.versionNumber.asString</span>
            </td>
         }
        }
        case EnvironmentWithoutVersion(env) => {
            <td id="row@{row.index}_version_@{env.asString}"></td>
        }
    }
    <td>
        <a id="link-to-deployment-timeline-for-@{row.applicationName}" href="@uk.gov.hmrc.cataloguefrontend.whatsrunningwhere.routes.DeploymentHistoryController.graph(row.applicationName) "><span class="glyphicon glyphicon-stats"></span> </a>
    </td>
  </tr>
}
</tbody>

