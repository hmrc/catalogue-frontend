@*
* Copyright 2016 HM Revenue & Customs
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*@
@import uk.gov.hmrc.cataloguefrontend.RepositoryDetails
@import java.time.format.DateTimeFormatter
@import uk.gov.hmrc.cataloguefrontend.DateHelper._

@import uk.gov.hmrc.cataloguefrontend.connector.model.Dependencies
@import uk.gov.hmrc.cataloguefrontend.connector.model.Version
@import uk.gov.hmrc.cataloguefrontend.connector.model.LibraryDependencyState
@(mayBeDependencies: Option[Dependencies])

<div>
    <div class="board">
        <h3 class="board__heading">Dependencies</h3>
        <div class="board__body">

            <div class="col-xs-8">

                <ul class="list list--minimal list-group row">


                    @if(mayBeDependencies.isDefined && mayBeDependencies.get.libraryDependenciesState.nonEmpty) {
                        <li>
                            <span class="col-xs-3"></span>
                            <span class="col-xs-3"><label>Current Version</label></span>
                            <span class="col-xs-1"><label> </label></span>
                            <span class="col-xs-3"><label>Latest Version</label></span>

                        </li>
                        @for(dependencyState <- mayBeDependencies.get.libraryDependenciesState) {
                            <li>
                                <div class="@{
                                    getRAGClass(dependencyState.currentVersion, dependencyState.latestVersion)
                                }" id="@{
                                    dependencyState.libraryName
                                }">
                                    <span class="col-xs-3">
                                    @if(isInternalDependency(dependencyState)) {
                                        <a href="/repositories/@{
                                            dependencyState.libraryName
                                        }">@dependencyState.libraryName</a>
                                    } else {
                                        @dependencyState.libraryName
                                    }
                                    </span>
                                    <span class="col-xs-3">@dependencyState.currentVersion</span>
                                    <span class="col-xs-1 glyphicon glyphicon-arrow-right"> </span>
                                    <span class="col-xs-3">@dependencyState.latestVersion</span>
                                </div>
                            </li>

                        }

                    } else {
                        <li class="col-xs-6">
                            No Library dependencies available
                        </li>
                    }

                </ul>
            </div>
            <div class="col-xs-4">
                <div>
                    <label>Legend:</label>
                    <ul class="list list--minimal list-group legend" >
                        <li><span class="green">Up to date</span></li>
                        <li><span class="amber">Minor version behind</span></li>
                        <li><span class="red">Major or more than 2 minor versions behind</span></li>
                    </ul>
                </div>
            </div>


            @*<label>Legend:</label>*@
            @*<div class="btn-group btn-group-sm" role="group">*@
                @*<button type="button" class="green btn btn-default">Up to date</button>*@
                @*<button type="button" class="amber btn btn-default">minor version behind</button>*@
                @*<button type="button" class="red btn btn-default">major version behind</button>*@
            @*</div>*@

            @*<div>*@
                @*<ul class="breadcrumb list list--minimal list-group">*@
                    @*<label>Legend:</label>*@
                    @*<li><span class="green">Up to date</span></li>*@
                    @*<li><span class="amber">minor version behind</span></li>*@
                    @*<li><span class="red">major version behind</span></li>*@
                @*</ul>*@
            @*</div>*@


        </div>
    </div>

@isInternalDependency(libraryDependencyState: LibraryDependencyState) = @{
    libraryDependencyState.latestVersion.isDefined
}

    @getRAGClass(currentVersion: Version, mayBeLatestVersion: Option[Version]) = @{
        mayBeLatestVersion.fold("grey") { latestVersion =>
            latestVersion - currentVersion match {
                case (0, 0, _) => "green" // green
                case (0, minor, _) if minor >= 1 => "amber" //amber
                case (major, minor, _) if major >= 1 => "red" //red
            }
        }
    }



</div>

